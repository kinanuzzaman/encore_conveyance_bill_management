import{_ as q,r as p,$ as R,o as u,a5 as h,a6 as l,f as s,e as t,C as A,Q as f,aw as g,ae as n,ac as T,a as w,ad as V,aL as E,a8 as N,a7 as b,aH as P,ay as $,ag as D,ah as L}from"./index.5b2acc78.js";import{Q as O,a as U,b as i}from"./QTable.9be2365e.js";import{C as S}from"./ClosePopup.a91d546e.js";import{A as H}from"./api-service.e4a3f494.js";import{u as z}from"./auth.store.b2378202.js";import{u as J}from"./use-quasar.b612f3c1.js";import{h as k}from"./moment.53181859.js";const C=o=>(D("data-v-cca91f00"),o=o(),L(),o),M={class:"float-right"},Y=C(()=>t("h1",{class:"text-2xl mt-10"},"Approval/Reject Process",-1)),F={class:"card"},G={class:"flex flex-col justify-end text-lg gap-3"},K={class:"flex flex-col gap-3"},W=C(()=>t("span",{class:"font-bold"},"Request by",-1)),X={class:"flex items-center gap-2"},Z=["src"],ee={key:1},te={class:"text-xs p-0.5 rounded text-white bg-gray-500"},se={class:"text-xs"},ae={class:"text-xs"},oe={class:"text-xs"},le={class:"text-xs"},re={class:"flex w-full justify-center"},ne={class:"flex w-1/2 justify-center gap-3 items-center"},ce={__name:"ApprovalProcess",props:{data:{type:Object,default:()=>({}),required:!0},user_type:{type:String,default:"payee",required:!0},req_type:{type:String,default:"cash",required:!0}},emits:["close"],setup(o,{emit:Q}){const a=o,j=[{name:"user",align:"left",label:"User",field:"user"},{name:"note",align:"left",label:"Note",field:"note"},{name:"status",align:"left",label:"Action",field:"status",sortable:!0},{name:"changed",align:"left",label:"Active",field:"changed",sortable:!0},{name:"timeStamp",align:"left",label:"Time",field:"timeStamp",sortable:!0}],B=new H,I=z(),y=J(),m=p(!1),_=p(!1),v=p(""),d=p([]);R(()=>{a.data.approvedBy.forEach(e=>{Object.keys(e).length!=0&&d.value.push({userId:e.user._id,user:e.user.first_name+" "+e.user.last_name,note:e.note,status:"Approved",changed:e.changed,timeStamp:k(e.timeStamp).format("LL | h:mma")})}),a.data.rejectedBy.forEach(e=>{Object.keys(e).length!=0&&d.value.push({userId:e.user._id,user:e.user.first_name+" "+e.user.last_name,note:e.note,status:"Rejected",changed:e.changed,timeStamp:k(e.timeStamp).format("LL | h:mma")})});const c=d.value.find(e=>e.userId===I.getUserInfo._id&&!e.changed);c?c.status==="Approved"?_.value=!0:m.value=!0:(m.value=!0,_.value=!0)});async function x(c){try{console.log(c);const e=await B.put(`/${a.req_type}-control/${a.data._id}`,{note:v.value,status:c});console.log(e),y.notify({message:"Request Approved",color:"green",icon:"check"}),Q("close")}catch(e){y.notify({message:e.message,color:"red",icon:"warning"})}}return(c,e)=>(u(),h($,{class:"my-card"},{default:l(()=>[s(g,{class:"text-center"},{default:l(()=>[t("div",M,[A(s(f,{icon:"close",flat:"",round:"",dense:""},null,512),[[S]])]),Y]),_:1}),t("div",F,[s(g,{class:"grid grid-cols-2"},{default:l(()=>[t("div",G,[t("span",null,"Type: "+n(a.data.type),1),t("span",null,"Amount: "+n(a.data.amount),1)]),t("div",K,[W,t("div",X,[s(T,{"font-size":"20px",color:"green","text-color":"white"},{default:l(()=>[a.data[o.user_type].profile_img?(u(),w("img",{key:0,src:a.data[o.user_type].profile_img,alt:""},null,8,Z)):(u(),w("span",ee,n(a.data[o.user_type].first_name.charAt(0)+a.data[o.user_type].last_name.charAt(0)),1))]),_:1}),t("div",null,[t("p",null,[V(n(a.data[o.user_type].first_name+" "+a.data[o.user_type].last_name)+" ",1),t("span",te,n(a.data[o.user_type].designation),1)]),t("p",null,n(a.data[o.user_type].email),1)])])])]),_:1}),s(g,null,{default:l(()=>[s(O,{title:"History",rows:d.value,columns:j,flat:""},{body:l(r=>[s(U,{props:r},{default:l(()=>[s(i,{key:"user"},{default:l(()=>[t("div",se,n(r.row.user),1)]),_:2},1024),s(i,{key:"note"},{default:l(()=>[t("div",ae,n(r.row.note),1)]),_:2},1024),s(i,{key:"status"},{default:l(()=>[t("div",oe,n(r.row.status),1)]),_:2},1024),s(i,{key:"changed"},{default:l(()=>[t("div",{class:E(["text-xs",r.row.changed?"text-red-500":"text-green"])},n(r.row.changed?"No":"Yes"),3)]),_:2},1024),s(i,{key:"timeStamp"},{default:l(()=>[t("div",le,n(r.row.timeStamp),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1}),s(P,null,{default:l(()=>[t("div",re,[s(N,{class:"w-1/2",dense:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=r=>v.value=r),type:"text",placeholder:"Notes"},null,8,["modelValue"]),t("div",ne,[m.value?(u(),h(f,{key:0,unelevated:"","no-caps":"",label:"Approve",color:"green",onClick:e[1]||(e[1]=r=>x("APPROVED"))})):b("",!0),_.value?(u(),h(f,{key:1,unelevated:"","no-caps":"",label:"Reject",color:"negative",onClick:e[2]||(e[2]=r=>x("REJECTED"))})):b("",!0),A(s(f,{unelevated:"","no-caps":"",label:"Close",color:"gray-500"},null,512),[[S]])])])]),_:1})])]),_:1}))}};var ve=q(ce,[["__scopeId","data-v-cca91f00"]]);export{ve as A};
