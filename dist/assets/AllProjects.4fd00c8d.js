import{_ as D,r as v,$ as O,a4 as I,o as r,a as Q,e as n,a5 as i,a7 as g,f as l,a6 as t,ab as W,aa as P,Q as A,ax as V,ae as s,ad as d,aK as E,ay as L,aL as z,aw as M,B as F,a9 as K}from"./index.5b2acc78.js";import{Q as q,a as G,b as u}from"./QTable.9be2365e.js";import{Q as y,b as w,a as f}from"./selection.9088e168.js";import{a as U}from"./QSelect.fbaf293c.js";import{Q as H}from"./QList.3973144f.js";import{A as J}from"./api-service.e4a3f494.js";import{A as X}from"./ApprovalProcess.6a7b5490.js";import{u as Y}from"./use-quasar.b612f3c1.js";import{u as Z}from"./auth.store.b2378202.js";import"./use-fullscreen.6b3ff2b1.js";import"./format.2a3572e1.js";import"./axios.33769ef8.js";import"./ClosePopup.a91d546e.js";import"./moment.53181859.js";const $=[{name:"title",required:!0,label:"Project Title",align:"left",field:m=>m.name,format:m=>`${m}`,sortable:!0},{name:"type",align:"left",label:"Type",field:"type",sortable:!0},{name:"description",align:"left",label:"Description",field:"description",sortable:!0},{name:"address",align:"left",label:"Address",field:"address",sortable:!0},{name:"budget",align:"left",label:"Budget",field:"budget",sortable:!0},{name:"expenses",align:"left",label:"Total Expenses",field:"expenses",sortable:!0},{name:"status",align:"left",label:"Status",field:"status",sortable:!0},{name:"createdBy",align:"left",label:"Creator",field:"createdBy",sortable:!0},{name:"vendor",align:"left",label:"Vendor Name",field:"vendor",sortable:!0},{name:"client",align:"left",label:"Client Name",field:"client",sortable:!0},{name:"approvals",align:"left",label:"Approvals",field:"approvals"},{name:"rejection",align:"left",label:"Rejection",field:"rejection"},{name:"action",label:"Action",field:"action"}],ee={components:{ApprovalProcess:X},setup(){const m=v([]),b=new J,p=Y(),o=Z(),h=v(),k=v([]),S=v(null),e=v(!1),a=v(!1),c=v({page:1,rowsPerPage:10,rowsNumber:10});async function _(j){const{page:x,rowsPerPage:B}=j.pagination;a.value=!0;const C=(await b.get("/project-control",{params:{page:x,limit:B}})).data;console.log("\u{1F680} ~ file: ExpensePage.vue:270 ~ onRequest ~ data:",C.data),k.value.splice(0,k.value.length,...C.data),console.log("\u{1F680} ~ file: AllProjects.vue:292 ~ onRequest ~ rows.value.:",k.value),c.value.rowsNumber=C.total,c.value.page=x,c.value.rowsPerPage=B,a.value=!1}O(()=>{h.value.requestServerInteraction()});function R(j){S.value=j,e.value=!0}function N(){e.value=!1,h.value.requestServerInteraction()}function T(j){p.dialog({title:"Delete Project Record",message:"Are you sure you want to delete this project record?",cancel:!0,persistent:!0}).onOk(()=>{b.delete(`/project-control/${j}`).then(()=>{p.notify({color:"green-4",textColor:"white",position:"top",icon:"cloud_done",message:"project record deleted successfully"}),h.value.requestServerInteraction()}).catch(x=>{p.notify({color:"red-4",textColor:"white",position:"top",icon:"error",message:x.response?x.response.data.message:"An error occured"})})})}return{columns:$,rows:k,selected:m,pagination:c,loading:a,tableRef:h,onRequest:_,approvalCandidate:S,approval:e,openStatusUpdateWindow:R,closeStatusWindow:N,deleteProject:T,authStore:o}}},te={class:"mx-4 my-6 flex justify-between"},le=n("div",{class:"text-2xl font-semibold"},"Projects",-1),ae={class:"flex md:gap-x-5 gap-1 justify-items-end"},oe={class:"q-px-md gt-sm"},se={class:"text-xs"},ne={class:"text-xs"},re={class:"text-xs"},de={class:"text-xs"},ce={class:"text-xs"},ie={class:"text-xs"},ue={class:"bg-blue-200 inline p-2 text-blue-800"},fe={class:"bg-red-200 inline p-2 text-red-800"},me={class:"column items-end"},_e={class:"q-pa-md lt-md"},be={class:"column items-end"},we={class:"bg-blue-200 inline p-1 text-blue-800"},ve={class:"bg-red-200 inline p-1 text-red-800"};function ge(m,b,p,o,h,k){const S=I("approval-process");return r(),Q(P,null,[n("section",te,[le,n("div",ae,[n("div",null,[o.authStore.canAccess("project_create")?(r(),i(A,{key:0,outline:"",rounded:"",to:"/projects/add-project",label:"Add project","no-caps":""})):g("",!0)])])]),n("section",null,[n("div",oe,[l(q,{flat:"",class:"h-[85vh]",ref:"tableRef",onRequest:o.onRequest,rows:o.rows,columns:o.columns,style:{background:"rgba(244, 244, 244, 0.8)"},"selected-rows-label":m.getSelectedString,selection:"multiple",selected:o.selected,"onUpdate:selected":b[0]||(b[0]=e=>o.selected=e),"row-key":"name"},{body:t(e=>[l(G,{props:e},{default:t(()=>[l(u,null,{default:t(()=>[l(V,{modelValue:e.selected,"onUpdate:modelValue":a=>e.selected=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(u,{class:""},{default:t(()=>[n("div",null,[n("div",se,s(e.row.title),1)])]),_:2},1024),l(u,{class:""},{default:t(()=>[n("div",ne,s(e.row.type||"-"),1)]),_:2},1024),l(u,{class:""},{default:t(()=>[n("div",re,s(e.row.description||"-"),1)]),_:2},1024),l(u,{class:""},{default:t(()=>[n("div",null,[n("div",de,s(e.row.address||"-"),1)])]),_:2},1024),l(u,{class:""},{default:t(()=>[n("div",null,[n("div",ce,s(e.row.budget||"-"),1)])]),_:2},1024),l(u,{class:""},{default:t(()=>[n("div",null,[n("div",ie,s(e.row.total_expenses||"-"),1)])]),_:2},1024),l(u,{class:""},{default:t(()=>[d(s(e.row.status),1)]),_:2},1024),l(u,{class:""},{default:t(()=>[d(s(e.row.createdBy?e.row.createdBy.first_name+" "+e.row.createdBy.last_name:"-"),1)]),_:2},1024),l(u,{class:""},{default:t(()=>[d(s(e.row.vendor?e.row.vendor.first_name+" "+e.row.vendor.last_name:"-"),1)]),_:2},1024),l(u,{class:""},{default:t(()=>[d(s(e.row.client?e.row.client.first_name+" "+e.row.client.last_name:"-"),1)]),_:2},1024),l(u,null,{default:t(()=>{var a;return[n("div",ue,s((a=e.row.approvedBy)==null?void 0:a.filter(c=>Object.hasOwn(c,"changed")&&!c.changed).length),1)]}),_:2},1024),l(u,null,{default:t(()=>{var a;return[n("div",fe,s((a=e.row.rejectedBy)==null?void 0:a.filter(c=>Object.hasOwn(c,"changed")&&!c.changed).length),1)]}),_:2},1024),l(u,null,{default:t(()=>[n("div",me,[l(A,{flat:"",icon:"more_vert"},{default:t(()=>[l(U,{anchor:"top middle",self:"top right"},{default:t(()=>[l(y,{clickable:"",onClick:a=>m.$router.push(`/projects/add-project/?id=${e.row._id}`)},{default:t(()=>[l(w,null,{default:t(()=>[d("Details")]),_:1})]),_:2},1032,["onClick"]),o.authStore.canAccess("project_write")?(r(),i(y,{key:0,clickable:"",onClick:a=>o.deleteProject(e.row._id)},{default:t(()=>[l(w,null,{default:t(()=>[d("Delete")]),_:1})]),_:2},1032,["onClick"])):g("",!0),o.authStore.canAccess("project_write")||o.authStore.canAccess("project_read")?(r(),i(y,{key:1,clickable:"",onClick:a=>o.openStatusUpdateWindow(e.row)},{default:t(()=>[l(w,null,{default:t(()=>[d("Update Status")]),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["onRequest","rows","columns","selected-rows-label","selected"])]),n("div",_e,[l(q,{rows:o.rows,columns:o.columns,"row-key":"name",selection:"multiple",selected:o.selected,"onUpdate:selected":b[1]||(b[1]=e=>o.selected=e),filter:m.filter,grid:"","hide-header":""},{item:t(e=>[n("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:E(e.selected?"transform: scale(0.95);":"")},[l(L,{bordered:"",flat:"",class:z(e.selected?m.$q.dark.isActive?"bg-grey-9":"bg-grey-2":"")},{default:t(()=>[l(M,{class:"flex justify-between"},{default:t(()=>[l(V,{dense:"",modelValue:e.selected,"onUpdate:modelValue":a=>e.selected=a,label:e.row.name},null,8,["modelValue","onUpdate:modelValue","label"]),n("div",be,[l(A,{flat:"",icon:"more_vert"},{default:t(()=>[l(U,{anchor:"top middle",self:"top right"},{default:t(()=>[l(y,{clickable:"",onClick:a=>m.$router.push(`/projects/add-project/?id=${e.row._id}`)},{default:t(()=>[l(w,null,{default:t(()=>[d("Details")]),_:1})]),_:2},1032,["onClick"]),o.authStore.canAccess("project_write")?(r(),i(y,{key:0,clickable:"",onClick:a=>o.deleteProject(e.row._id)},{default:t(()=>[l(w,null,{default:t(()=>[d("Delete")]),_:1})]),_:2},1032,["onClick"])):g("",!0),o.authStore.canAccess("project_write")||o.authStore.canAccess("project_read")?(r(),i(y,{key:1,clickable:"",onClick:a=>o.openStatusUpdateWindow(e.row)},{default:t(()=>[l(w,null,{default:t(()=>[d("Update Status")]),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024)])]),_:2},1024),l(F),l(H,{dense:""},{default:t(()=>[(r(!0),Q(P,null,K(e.cols.filter(a=>a.name!=="desc"),a=>(r(),i(y,{key:a.name},{default:t(()=>[l(w,null,{default:t(()=>[a.label!="Action"?(r(),i(f,{key:0,caption:""},{default:t(()=>[d(s(a.label),1)]),_:2},1024)):g("",!0)]),_:2},1024),l(w,{side:"",class:"text-black"},{default:t(()=>[a.label=="Project Title"?(r(),i(f,{key:0},{default:t(()=>[d(s(e.row.title),1)]),_:2},1024)):a.label=="Type"?(r(),i(f,{key:1},{default:t(()=>[d(s(e.row.type),1)]),_:2},1024)):a.label=="Description"?(r(),i(f,{key:2},{default:t(()=>[d(s(e.row.description),1)]),_:2},1024)):a.label=="Address"?(r(),i(f,{key:3},{default:t(()=>[d(s(e.row.address),1)]),_:2},1024)):a.label=="Budget"?(r(),i(f,{key:4},{default:t(()=>[d(s(e.row.budget),1)]),_:2},1024)):a.label=="Total Expenses"?(r(),i(f,{key:5},{default:t(()=>[d(s(e.row.total_expenses),1)]),_:2},1024)):a.label=="Status"?(r(),i(f,{key:6},{default:t(()=>[d(s(e.row.status),1)]),_:2},1024)):a.label=="Creator"?(r(),i(f,{key:7},{default:t(()=>{var c,_;return[d(s(((c=e.row.createdBy)==null?void 0:c.first_name)+" "+((_=e.row.createdBy)==null?void 0:_.last_name)),1)]}),_:2},1024)):a.label=="Vendor Name"?(r(),i(f,{key:8},{default:t(()=>[d(s(e.row.vendor?e.row.vendor.first_name+" "+e.row.vendor.last_name:"-"),1)]),_:2},1024)):a.label=="Client Name"?(r(),i(f,{key:9},{default:t(()=>[d(s(e.row.client?e.row.client.first_name+" "+e.row.client.last_name:"-"),1)]),_:2},1024)):a.label=="Approvals"?(r(),i(f,{key:10},{default:t(()=>{var c;return[n("div",we,s((c=e.row.approvedBy)==null?void 0:c.filter(_=>Object.hasOwn(_,"changed")&&!_.changed).length),1)]}),_:2},1024)):a.label=="Rejection"?(r(),i(f,{key:11},{default:t(()=>{var c;return[n("div",ve,s((c=e.row.rejectedBy)==null?void 0:c.filter(_=>Object.hasOwn(_,"changed")&&!_.changed).length),1)]}),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),_:1},8,["rows","columns","selected","filter"])]),l(W,{modelValue:o.approval,"onUpdate:modelValue":b[2]||(b[2]=e=>o.approval=e),persistent:""},{default:t(()=>[l(S,{data:o.approvalCandidate,req_type:"project",user_type:"createdBy",onClose:o.closeStatusWindow},null,8,["data","onClose"])]),_:1},8,["modelValue"])])],64)}var Re=D(ee,[["render",ge]]);export{Re as default};
