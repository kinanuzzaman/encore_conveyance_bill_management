import{r as d,aI as T,$ as A,o as s,a as c,e as t,ae as m,a5 as l,Q as p,a7 as v,f as g,az as C,a6 as u,ay as j,aa as Q,a9 as V,aw as G,bl as $}from"./index.5b2acc78.js";import{Q as N,a as R,b as U}from"./QTable.9be2365e.js";import{u as q}from"./use-quasar.b612f3c1.js";import{A as z}from"./api-service.e4a3f494.js";import{u as M}from"./auth.store.b2378202.js";import"./QList.3973144f.js";import"./QSelect.fbaf293c.js";import"./selection.9088e168.js";import"./format.2a3572e1.js";import"./use-fullscreen.6b3ff2b1.js";import"./axios.33769ef8.js";const D={class:"mx-4 py-6 flex justify-between"},E={class:"flex items-center gap-3"},F={class:"text-2xl font-semibold"},I={class:"flex gap-3"},L={class:""},O={class:""},W={class:"q-px-md gt-sm"},H={key:1},J={key:1,class:"grid grid-cols-3 gap-3"},K={class:"flex flex-col gap-2"},X={class:"text-2xl"},Y={class:"text-gray-600"},ue={__name:"UserPermissionTable",setup(Z){const B=[{name:"role",label:"Title",align:"left",field:"title",sortable:!0},{name:"read",align:"left",label:"Read",field:"read",sortable:!0},{name:"create",align:"left",label:"Create",field:"create",sortable:!0},{name:"write",align:"left",label:"Write",field:"write",sortable:!0}],r=d([]),w=new z,f=q(),h=T(),x=M(),n=d(!0),_=d([]),y=d(!1),k=d(!1);A(async()=>{y.value=!0,await S(),y.value=!1});async function S(){try{const o=await w.get(`/rbac/grouped-role-permissions/${h.params.id}`);_.value=o.data.data,r.value=o.data.data.assigned_perm_ids}catch(o){f.notify({message:o.response?o.response.data.message:o.message,color:"negative",position:"top"})}}async function P(){try{k.value=!0,await w.post("/rbac/roles/assign-permissions",{role_id:h.params.id,permission_ids:r.value}),k.value=!1,f.notify({message:"Role updated",color:"positive",position:"top"}),S()}catch{f.notify({message:err.response?err.response.data.message:err.message,color:"negative",position:"top"})}}return(o,a)=>(s(),c("main",null,[t("section",D,[t("div",E,[t("span",F,m(n.value?"General":"System")+" Permission Control",1),n.value?(s(),l(p,{key:0,title:"Swap to System",color:"green",onClick:a[0]||(a[0]=e=>n.value=!1),"no-caps":"",class:"rounded-lg",flat:"",icon:"swap_vert"})):v("",!0),n.value?v("",!0):(s(),l(p,{key:1,title:"Swap to General",color:"red",onClick:a[1]||(a[1]=e=>n.value=!0),"no-caps":"",class:"rounded-lg",flat:"",icon:"swap_vert"}))]),t("div",I,[g(p,{color:"red",onClick:a[2]||(a[2]=e=>o.$router.back()),"no-caps":"",class:"rounded-lg",unelevated:"",label:"Back"}),C(x).canAccess("role_write")&&C(x).canAccess("access_control")?(s(),l(p,{key:0,color:"green",loading:k.value,onClick:a[3]||(a[3]=e=>P()),"no-caps":"",class:"rounded-lg",unelevated:"",label:"Save"},null,8,["loading"])):v("",!0)])]),t("div",L,[t("section",O,[t("div",W,[n.value?(s(),l(N,{key:0,flat:"",class:"h-[80vh]",rows:_.value.general_perms,loading:y.value,columns:B,style:{background:"rgba(244, 244, 244, 0.8)"},"rows-per-page-options":[15]},{body:u(e=>[g(R,{class:"",props:e},{default:u(()=>[(s(!0),c(Q,null,V(Object.keys(e.row),i=>(s(),l(U,{key:e.row[i]},{default:u(()=>[i!="title"?(s(),l($,{key:0,val:e.row[i]._id,modelValue:r.value,"onUpdate:modelValue":a[4]||(a[4]=b=>r.value=b),"checked-icon":"check",color:"red","unchecked-icon":"clear"},null,8,["val","modelValue"])):(s(),c("span",H,m(e.row[i]),1))]),_:2},1024))),128))]),_:2},1032,["props"])]),_:1},8,["rows","loading"])):(s(),c("div",J,[g(j,{class:"w-full h-full"},{default:u(()=>[g(G,null,{default:u(()=>[(s(!0),c(Q,null,V(_.value.system_perms,(e,i)=>(s(),c("div",{key:i,class:"flex justify-between"},[t("div",K,[t("span",X,m(e.perm_name),1),t("span",Y,m(e.perm_description),1)]),o.item!="title"?(s(),l($,{key:0,size:"xl",val:e._id,modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=b=>r.value=b),"checked-icon":"check",color:"red","unchecked-icon":"clear"},null,8,["val","modelValue"])):v("",!0)]))),128))]),_:1})]),_:1})]))])])])]))}};export{ue as default};
