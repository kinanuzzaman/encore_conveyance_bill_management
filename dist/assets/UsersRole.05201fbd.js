import{r as x,at as P,$ as T,o as p,a as j,e as l,az as r,a5 as y,bk as k,Q as C,a7 as A,f as e,a6 as t,ab as M,ae as i,ad as d,ay as Q,aw as _,B as S,a8 as D,aH as F}from"./index.5b2acc78.js";import{Q as q,a as z,b as g}from"./QTable.9be2365e.js";import{u as E,Q as B,a as b,b as h}from"./rbac.store.a503f2e1.js";import{u as H}from"./use-quasar.b612f3c1.js";import{A as I}from"./api-service.e4a3f494.js";import{u as L}from"./auth.store.b2378202.js";import"./QList.3973144f.js";import"./QSelect.fbaf293c.js";import"./selection.9088e168.js";import"./format.2a3572e1.js";import"./use-fullscreen.6b3ff2b1.js";import"./axios.33769ef8.js";const O={class:"mx-4 py-6 flex justify-between"},G=l("div",{class:"text-2xl font-semibold"},"User Role",-1),J={class:""},K={class:""},W={class:"q-px-md gt-sm"},X={class:"bg-blue-200 inline p-2 text-blue-800"},Y={class:"text-xs"},Z={class:"column items-end"},ee={class:"q-pa-md lt-md"},te={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition"},se={class:"text-lg font-bold"},le={class:"column items-end"},oe={class:"flex flex-col gap-3"},ae={class:"block gap-2 items-center"},ne=l("span",{class:"text-gray-600 pr-2"},"Description: ",-1),re={class:"font-bold"},ie={class:"block gap-2 items-center"},de=l("span",{class:"text-gray-600 pr-2"},"Permissions Assigned: ",-1),ce={class:"font-bold"},Ce={__name:"UsersRole",setup(ue){const R=[{name:"role",required:!0,label:"Role",align:"left",field:a=>a.name,format:a=>`${a}`,sortable:!0},{name:"createdAt",align:"left",label:"Description",field:"createdAt",sortable:!0},{name:"permissions",align:"left",label:"Permissions Assigned",field:"permissions",sortable:!0},{name:"action",label:"Action",field:"action"}],$=new I,c=E(),u=H(),m=L(),w=x(!1);let n=x(!1);const f=P({role_name:null,role_description:null,permissions:[]}),N=x(!1);T(()=>{c.fetchAllRoles()});const U=async()=>{try{w.value=!0,await $.post("/rbac/roles",f),u.notify({message:"Role created",color:"positive",position:"top"}),c.fetchAllRoles(),w.value=!1,n.value=!1}catch(a){u.notify({message:a.response?a.response.data.message:a.message,color:"negative",position:"top"})}};function V(a){u.dialog({title:"Delete Project Record",message:"Are you sure you want to delete this project record?",cancel:!0,persistent:!0}).onOk(()=>{$.delete(`/rbac/roles/${a}`).then(()=>{u.notify({color:"green-4",position:"top",icon:"cloud_done",message:"role record deleted successfully"}),c.fetchAllRoles()}).catch(o=>{u.notify({color:"red-4",textColor:"white",position:"top",icon:"error",message:o.response?o.response.data.message:"An error occured"})})})}return(a,o)=>(p(),j("main",null,[l("section",O,[G,l("div",null,[r(m).canAccess("role_create")?(p(),y(C,{key:0,color:"orange",onClick:o[0]||(o[0]=s=>k(n)?n.value=!0:n=!0),class:"rounded-lg",unelevated:"",icon:"add",label:"Create Role"})):A("",!0)])]),l("div",J,[l("section",K,[l("div",W,[e(q,{flat:"",class:"h-[85vh]",rows:r(c).roles,loading:N.value,columns:R,style:{background:"rgba(244, 244, 244, 0.8)"}},{body:t(s=>[e(z,{class:"",props:s},{default:t(()=>[e(g,null,{default:t(()=>[l("div",X,i(s.row.role_name),1)]),_:2},1024),e(g,null,{default:t(()=>[l("div",null,[l("div",Y,i(s.row.role_description),1)])]),_:2},1024),e(g,null,{default:t(()=>[d(i(s.row.permissions.length),1)]),_:2},1024),e(g,null,{default:t(()=>[l("div",Z,[e(B,{square:"",flat:"",padding:"none","text-color":"black",icon:"add",direction:"left",class:"border border-black"},{default:t(()=>[r(m).canAccess("role_write")&&r(m).canAccess("access_control")?(p(),y(h,{key:0,flat:"",onClick:v=>a.$router.push(`role/permission-table/${s.row._id}`),icon:"settings",class:"bg-transparent shadow-none text-blue-500"},{default:t(()=>[e(b,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:t(()=>[d(" Manage Permissions ")]),_:1})]),_:2},1032,["onClick"])):A("",!0),r(m).canAccess("role_write")?(p(),y(h,{key:1,flat:"",onClick:v=>V(s.row._id),icon:"delete",class:"bg-transparent shadow-none text-gray-700"},{default:t(()=>[e(b,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:t(()=>[d(" Delete ")]),_:1})]),_:2},1032,["onClick"])):A("",!0)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),l("div",ee,[e(q,{rows:r(c).roles,columns:R,"row-key":"name",selection:"multiple",selected:a.selected,"onUpdate:selected":o[1]||(o[1]=s=>a.selected=s),filter:a.filter,grid:"","hide-header":""},{item:t(s=>[l("div",te,[e(Q,{bordered:"",flat:""},{default:t(()=>[e(_,{class:"flex justify-between items-center bg-green text-white"},{default:t(()=>[l("span",se,i(s.row.role_name),1),l("div",le,[e(B,{square:"",flat:"",padding:"none","text-color":"white",icon:"add",direction:"left",class:"border border-white"},{default:t(()=>[e(h,{flat:"",onClick:v=>a.$router.push(`role/permission-table/${s.row._id}`),icon:"settings",class:"bg-transparent shadow-none text-white"},{default:t(()=>[e(b,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:t(()=>[d(" Manage Permissions ")]),_:1})]),_:2},1032,["onClick"]),e(h,{flat:"",icon:"delete",onClick:v=>V(s.row._id),class:"bg-transparent shadow-none text-red-600"},{default:t(()=>[e(b,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:t(()=>[d(" Delete ")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:2},1024),e(S),e(Q,{class:"w-full h-full"},{default:t(()=>[e(_,null,{default:t(()=>[l("div",oe,[l("div",ae,[ne,l("span",re,i(s.row.role_description),1)]),e(S),l("div",ie,[de,l("span",ce,i(s.row.permissions.length),1)])])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:1},8,["rows","selected","filter"])])])]),e(M,{modelValue:r(n),"onUpdate:modelValue":o[6]||(o[6]=s=>k(n)?n.value=s:n=s),class:"",persistent:""},{default:t(()=>[e(Q,{class:"my-card p-10",style:{width:"800px","max-width":"80vw"}},{default:t(()=>[e(_,{class:"text-h6"},{default:t(()=>[d("Create New Role")]),_:1}),e(_,{class:"flex flex-col gap-5"},{default:t(()=>[e(D,{outlined:"",modelValue:f.role_name,"onUpdate:modelValue":o[2]||(o[2]=s=>f.role_name=s),placeholder:"Role Name","bg-color":"white",dense:!0},null,8,["modelValue"]),e(D,{outlined:"",modelValue:f.role_description,"onUpdate:modelValue":o[3]||(o[3]=s=>f.role_description=s),placeholder:"Description","bg-color":"white",dense:!0},null,8,["modelValue"])]),_:1}),e(F,{align:"center",class:"row mx-2 py-5"},{default:t(()=>[e(C,{label:"Create",color:"green",loading:w.value,class:"col",onClick:o[4]||(o[4]=s=>U())},null,8,["loading"]),e(C,{label:"Cancel",color:"negative",class:"col",onClick:o[5]||(o[5]=s=>k(n)?n.value=!1:n=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ce as default};
