import{_ as W,r as f,at as Y,$ as z,a4 as I,o as r,a as L,e as n,f as t,a6 as a,Q as k,a5 as c,a7 as p,ab as G,bl as H,B as O,ax as B,ae as u,ad as m,aK as K,ay as J,aL as X,aw as Z,aa as $,a9 as ee,ag as ae,ah as le}from"./index.5b2acc78.js";import{a as U,b as te}from"./QSelect.fbaf293c.js";import{Q as P,a as oe,b as _}from"./QTable.9be2365e.js";import{Q as C,b,a as y}from"./selection.9088e168.js";import{Q as ne}from"./QList.3973144f.js";import{A as se}from"./api-service.e4a3f494.js";import{A as re}from"./ApprovalProcess.6a7b5490.js";import{u as de}from"./use-quasar.b612f3c1.js";import{u as ie}from"./auth.store.b2378202.js";import{h as ce}from"./moment.53181859.js";import{S as ue}from"./SearchAddCompo.f8c630c2.js";import"./format.2a3572e1.js";import"./use-fullscreen.6b3ff2b1.js";import"./axios.33769ef8.js";import"./ClosePopup.a91d546e.js";const V=f([{name:"user",required:!0,label:"Request Type",align:"left",field:d=>d.name,format:d=>`${d}`,sortable:!0},{name:"email",align:"left",label:"Amount",field:"email",sortable:!0},{name:"phone",align:"left",label:"Paid By",field:"phone",sortable:!0},{name:"created",align:"left",label:"User",field:"created",sortable:!0},{name:"location",align:"left",label:"Location",field:"location"},{name:"createdAt",align:"left",label:"Created On",field:"createdAt",sortable:!0},{name:"status",align:"left",label:"Status",field:"status",sortable:!0},{name:"role",align:"left",label:"Approvals",field:"role"},{name:"role",align:"left",label:"Rejection",field:"role"},{name:"action",label:"Action",field:"action"}]),me=[{label:"Product Purchase",value:"ProductPurchase",type:"PRODUCT_PURCHASE"},{label:"Office",value:"OfficeExpense",type:"OFFICE"},{label:"Delivery",value:"DeliveryExp",type:"DELIVERY"},{label:"Conveyance",value:"ConveyanceExp",type:"CONVINCE"},{label:"Factory",value:"FactoryExp",type:"FACTORY"},{label:"BP",value:"BpExp",type:"BP"},{label:"Labour",value:"LabourExp",type:"LABOUR"},{label:"Marketing",value:"MarketingExp",type:"MARKETING"},{label:"Mobile Allowance",value:"MobileAllowance",type:"MOBILE_ALLOWANCE"},{label:"Salary Request",value:"SalaryExp",type:"SALARY"},{label:"Other",value:"OtherBill",type:"OTHERS"}],fe={components:{SearchAddCompo:ue,ApprovalProcess:re},setup(){const d=f([]),i=new se,R=de(),l=ie(),g=f(),S=f([]),x=f(!1),q=f(null),e=f(!1),o=f({page:1,rowsPerPage:10,rowsNumber:10}),s=Y({own_data:!1,employee:null,type:null});function h(){s.own_data&&(A.payee=l.getUserInfo._id),s.employee&&(A.payee=s.employee),s.type&&(A.request_type=s.type.type),g.value.requestServerInteraction()}function T(){s.own_data=!1,s.employee=null,s.type=null,A={},g.value.requestServerInteraction()}let A={};async function N(v){const{page:w,rowsPerPage:E}=v.pagination;x.value=!0;const Q=(await i.get("/cash-control",{params:{page:w,limit:E,filter:A}})).data;S.value.splice(0,S.value.length,...Q.data),o.value.rowsNumber=Q.total,o.value.page=w,o.value.rowsPerPage=E,x.value=!1}z(()=>{l.getUserRoleName!=="super_admin"&&j(),g.value.requestServerInteraction()});function F(){e.value=!1,g.value.requestServerInteraction()}function M(v){q.value=v,e.value=!0}function D(v){R.dialog({title:"Delete Cash Record",message:"Are you sure you want to delete this cash record?",cancel:!0,persistent:!0}).onOk(()=>{i.delete(`/cash-control/${v}`).then(()=>{R.notify({color:"green-4",textColor:"white",position:"top",icon:"cloud_done",message:"Cash record deleted successfully"}),g.value.requestServerInteraction()}).catch(w=>{R.notify({color:"red-4",textColor:"white",position:"top",icon:"error",message:w.response?w.response.data.message:"An error occured"})})})}function j(){const v=V.value.findIndex(w=>w.name==="location");v!==-1&&V.value.splice(v,1)}return{tableRef:g,moment:ce,approval:e,pagination:o,loading:x,onRequest:N,selected:d,columns:V,rows:S,model:f(null),name:f(null),designation:f(null),options:["Google","Facebook","Twitter","Apple","Oracle"],val:f(!0),getSelectedString(){return d.value.length===0?"":`${d.value.length} record${d.value.length>1?"s":""} selected of ${S.value.length}`},openStatusUpdateWindow:M,approvalCandidate:q,closeStatusWindow:F,deleteCC:D,authStore:l,cash_types:me,data_filter:s,doFilter:h,clearFilter:T}}},_e=d=>(ae("data-v-9a483cf4"),d=d(),le(),d),ye={class:"mx-4 my-6 flex justify-between"},ve=_e(()=>n("div",{class:"text-2xl font-semibold"},"Cash Request",-1)),pe={class:"flex md:gap-x-5 gap-1 justify-items-end"},be={class:"flex flex-col gap-3 w-auto q-pa-md"},ge={class:""},he={class:""},we={class:"q-px-md gt-sm"},Ce={class:"text-xs"},ke={class:"text-xs"},Se={class:"text-xs"},xe={class:"text-xs"},Ae=["href"],Re={class:"bg-blue-200 inline p-2 text-blue-800"},qe={class:"bg-red-200 inline p-2 text-red-800"},Ue={class:"column items-end"},Ve={class:"q-pa-md lt-md"},Ee={class:"column items-end"},Qe=["href"],Ie={class:"bg-blue-200 inline p-1 text-blue-800"},Le={class:"bg-red-200 inline p-1 text-red-800"};function Oe(d,i,R,l,g,S){const x=I("SearchAddCompo"),q=I("approval-process");return r(),L("main",null,[n("section",ye,[ve,n("div",pe,[n("div",null,[t(k,{outline:"",label:"Filter",rounded:""},{default:a(()=>[t(U,{"max-width":"500px"},{default:a(()=>[n("div",be,[t(H,{modelValue:l.data_filter.own_data,"onUpdate:modelValue":i[0]||(i[0]=e=>l.data_filter.own_data=e),label:"My Request"},null,8,["modelValue"]),t(te,{dense:"",outlined:"",modelValue:l.data_filter.type,"onUpdate:modelValue":i[1]||(i[1]=e=>l.data_filter.type=e),options:l.cash_types,label:"Type",filled:""},null,8,["modelValue","options"]),t(x,{disable:l.data_filter.own_data,onSelected:i[2]||(i[2]=e=>l.data_filter.employee=e),label:"Employee",api:"users",userType:"EMPLOYEE"},null,8,["disable"]),t(O,{class:"mt-3"}),t(k,{color:"green",label:"Apply","no-caps":"",onClick:l.doFilter},null,8,["onClick"]),t(k,{color:"red",label:"Clear","no-caps":"",onClick:l.clearFilter},null,8,["onClick"])])]),_:1})]),_:1})]),n("div",null,[l.authStore.canAccess("cash_create")?(r(),c(k,{key:0,outline:"",rounded:"",to:"/cash/add-cash",label:"Add request","no-caps":""})):p("",!0)])])]),n("div",ge,[n("section",he,[n("div",we,[t(P,{flat:"",class:"h-[85vh]",rows:l.rows,onRequest:l.onRequest,pagination:l.pagination,"onUpdate:pagination":i[3]||(i[3]=e=>l.pagination=e),loading:l.loading,ref:"tableRef",columns:l.columns,style:{background:"rgba(244, 244, 244, 0.8)"},"selected-rows-label":l.getSelectedString,selection:"multiple",selected:l.selected,"onUpdate:selected":i[4]||(i[4]=e=>l.selected=e),"row-key":"name"},{body:a(e=>[t(oe,{class:"",props:e},{default:a(()=>[t(_,null,{default:a(()=>[t(B,{modelValue:e.selected,"onUpdate:modelValue":o=>e.selected=o},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(_,null,{default:a(()=>[n("div",null,[n("div",Ce,u(e.row.type),1)])]),_:2},1024),t(_,null,{default:a(()=>[n("div",null,[n("div",ke,u(e.row.amount),1)])]),_:2},1024),t(_,null,{default:a(()=>{var o,s;return[n("div",null,[n("div",Se,u(((o=e.row.payer)==null?void 0:o.first_name)+" "+((s=e.row.payer)==null?void 0:s.last_name)),1)])]}),_:2},1024),t(_,null,{default:a(()=>{var o,s;return[n("div",null,[n("div",xe,u(((o=e.row.payee)==null?void 0:o.first_name)+" "+((s=e.row.payee)==null?void 0:s.last_name)),1)])]}),_:2},1024),l.authStore.getUserRoleName=="super_admin"&&e.row.creator_location?(r(),c(_,{key:0},{default:a(()=>[n("a",{target:"_blank",class:"text-blue-500",href:`https://www.google.com/maps/place/${e.row.creator_location.latitude+","+e.row.creator_location.longitude}`},"Open Map",8,Ae)]),_:2},1024)):p("",!0),t(_,null,{default:a(()=>[m(u(l.moment(e.row.createdAt).format("LL | h:mma")),1)]),_:2},1024),t(_,null,{default:a(()=>[m(u(e.row.status),1)]),_:2},1024),t(_,null,{default:a(()=>[n("div",Re,u(e.row.approvedBy.filter(o=>!o.changed).length),1)]),_:2},1024),t(_,null,{default:a(()=>[n("div",qe,u(e.row.rejectedBy.filter(o=>!o.changed).length),1)]),_:2},1024),t(_,null,{default:a(()=>[n("div",Ue,[t(k,{flat:"",icon:"more_vert"},{default:a(()=>[t(U,{anchor:"top middle",self:"top right"},{default:a(()=>[t(C,{clickable:"",onClick:o=>d.$router.push(`/cash/add-cash?id=${e.row._id}`)},{default:a(()=>[t(b,null,{default:a(()=>[m("Details")]),_:1})]),_:2},1032,["onClick"]),l.authStore.canAccess("cash_write")?(r(),c(C,{key:0,clickable:"",onClick:o=>l.deleteCC(e.row._id)},{default:a(()=>[t(b,null,{default:a(()=>[m("Delete")]),_:1})]),_:2},1032,["onClick"])):p("",!0),l.authStore.canAccess("cash_write")||l.authStore.canAccess("cash_read")?(r(),c(C,{key:1,clickable:"",onClick:o=>l.openStatusUpdateWindow(e.row)},{default:a(()=>[t(b,null,{default:a(()=>[m("Update Status")]),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","onRequest","pagination","loading","columns","selected-rows-label","selected"])]),n("div",Ve,[t(P,{rows:l.rows,columns:l.columns,"row-key":"name",selection:"multiple",selected:l.selected,"onUpdate:selected":i[5]||(i[5]=e=>l.selected=e),filter:d.filter,grid:"","hide-header":""},{item:a(e=>[n("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:K(e.selected?"transform: scale(0.95);":"")},[t(J,{bordered:"",flat:"",class:X(e.selected?d.$q.dark.isActive?"bg-grey-9":"bg-grey-2":"")},{default:a(()=>[t(Z,{class:"flex justify-between"},{default:a(()=>[t(B,{dense:"",modelValue:e.selected,"onUpdate:modelValue":o=>e.selected=o,label:e.row.name},null,8,["modelValue","onUpdate:modelValue","label"]),n("div",Ee,[t(k,{flat:"",icon:"more_vert"},{default:a(()=>[t(U,{anchor:"top middle",self:"top right"},{default:a(()=>[t(C,{clickable:"",onClick:o=>d.$router.push(`/cash/add-cash?id=${e.row._id}`)},{default:a(()=>[t(b,null,{default:a(()=>[m("Details")]),_:1})]),_:2},1032,["onClick"]),l.authStore.canAccess("cash_write")?(r(),c(C,{key:0,clickable:"",onClick:o=>l.deleteCC(e.row._id)},{default:a(()=>[t(b,null,{default:a(()=>[m("Delete")]),_:1})]),_:2},1032,["onClick"])):p("",!0),l.authStore.canAccess("cash_write")||l.authStore.canAccess("cash_read")?(r(),c(C,{key:1,clickable:"",onClick:o=>l.openStatusUpdateWindow(e.row)},{default:a(()=>[t(b,null,{default:a(()=>[m("Update Status")]),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)])]),_:2},1024),t(O),t(ne,{dense:""},{default:a(()=>[(r(!0),L($,null,ee(e.cols.filter(o=>o.name!=="desc"),o=>(r(),c(C,{key:o.name},{default:a(()=>[t(b,null,{default:a(()=>[o.label!="Action"?(r(),c(y,{key:0},{default:a(()=>[m(u(o.label),1)]),_:2},1024)):p("",!0)]),_:2},1024),t(b,{side:""},{default:a(()=>[o.label=="Request Type"?(r(),c(y,{key:0},{default:a(()=>[m(u(e.row.type),1)]),_:2},1024)):o.label=="Amount"?(r(),c(y,{key:1},{default:a(()=>[m(u(e.row.amount),1)]),_:2},1024)):o.label=="Paid By"?(r(),c(y,{key:2},{default:a(()=>{var s,h;return[m(u(((s=e.row.payer)==null?void 0:s.first_name)+" "+((h=e.row.payer)==null?void 0:h.last_name)),1)]}),_:2},1024)):o.label=="User"?(r(),c(y,{key:3},{default:a(()=>{var s,h;return[m(u(((s=e.row.payee)==null?void 0:s.first_name)+" "+((h=e.row.payee)==null?void 0:h.last_name)),1)]}),_:2},1024)):o.label=="Location"&&l.authStore.getUserRoleName=="super_admin"&&e.row.creator_location?(r(),c(y,{key:4},{default:a(()=>[n("a",{target:"_blank",class:"text-blue-500",href:`https://www.google.com/maps/place/${e.row.creator_location.latitude+","+e.row.creator_location.longitude}`},"Open Map",8,Qe)]),_:2},1024)):o.label=="Status"?(r(),c(y,{key:5},{default:a(()=>[m(u(e.row.status),1)]),_:2},1024)):o.label=="Created On"?(r(),c(y,{key:6},{default:a(()=>[m(u(l.moment(e.row.createdAt).format("LL | h:mma")),1)]),_:2},1024)):o.label=="Approvals"?(r(),c(y,{key:7},{default:a(()=>[n("div",Ie,u(e.row.approvedBy.filter(s=>!s.changed).length),1)]),_:2},1024)):o.label=="Rejection"?(r(),c(y,{key:8},{default:a(()=>[n("div",Le,u(e.row.rejectedBy.filter(s=>!s.changed).length),1)]),_:2},1024)):p("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),_:1},8,["rows","columns","selected","filter"])])])]),t(G,{modelValue:l.approval,"onUpdate:modelValue":i[6]||(i[6]=e=>l.approval=e),persistent:""},{default:a(()=>[t(q,{data:l.approvalCandidate,user_type:"payee",onClose:l.closeStatusWindow},null,8,["data","onClose"])]),_:1},8,["modelValue"])])}var Ze=W(fe,[["render",Oe],["__scopeId","data-v-9a483cf4"]]);export{Ze as default};
