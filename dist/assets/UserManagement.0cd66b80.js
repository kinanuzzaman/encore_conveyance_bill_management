import{_ as X,r as c,at as Z,$,a4 as ee,o as i,a as S,e as r,a5 as g,Q as V,a7 as _,f as l,a6 as o,ab as O,ac as ae,ae as u,ad as p,aK as le,ay as q,aL as te,aw as L,ax as oe,B as se,aa as ne,a9 as re,a8 as f,E as Q,aH as F}from"./index.5b2acc78.js";import{Q as j,a as de,b as v}from"./QTable.9be2365e.js";import{Q as ie,a as ue,b as M}from"./QSelect.fbaf293c.js";import{u as me,Q as ce,a as N,b as T}from"./rbac.store.a503f2e1.js";import{b as x,Q as R,a as I}from"./selection.9088e168.js";import{Q as ge}from"./QList.3973144f.js";import{u as fe}from"./user.store.f9dc60f8.js";import{u as be}from"./use-quasar.b612f3c1.js";import{A as pe}from"./api-service.e4a3f494.js";import{u as _e}from"./auth.store.b2378202.js";import{A as ve}from"./AvatarUploader.b3fd4829.js";import"./use-fullscreen.6b3ff2b1.js";import"./format.2a3572e1.js";import"./axios.33769ef8.js";const we=[{name:"user",required:!0,label:"User",align:"left",field:d=>d.name,format:d=>`${d}`,sortable:!0},{name:"email",align:"left",label:"Email",field:"email",sortable:!0},{name:"phone_number",align:"left",label:"Phone",field:"phone_number",sortable:!0},{name:"createdAt",align:"left",label:"Created",field:"createdAt",sortable:!0},{name:"status",align:"left",label:"Status",field:"status",sortable:!0},{name:"role",align:"left",label:"Role",field:"role"},{name:"action",label:"Action",field:"action"}],ye={components:{AvatarUploader:ve},setup(){const d=new pe,t=fe(),h=me(),a=_e(),b=be(),w=c({create_btn:!1,update_btn:!1,status_btn:!1}),C=c(!1),e=c({}),s=new FormData;let k=c(!1);const U=Z({first_name:null,last_name:null,email:null,phone_number:null,designation:null,salary:null,role:null}),y=c(),E=c([]),D=c(!1),A=c({page:1,rowsPerPage:10,rowsNumber:10});async function z(n){const{page:m,rowsPerPage:P}=n.pagination;D.value=!0;const B=await d.get("/users",{params:{page:m,limit:P,user_type:"EMPLOYEE"}});E.value.splice(0,E.value.length,...B.data.data),A.value.rowsNumber=B.data.total,A.value.page=m,A.value.rowsPerPage=P,D.value=!1}$(()=>{y.value.requestServerInteraction(),h.fetchAllRoles()});const K=async()=>{try{w.value.create_btn=!0,await t.userInvite({...U,role:U.role.value,user_type:"EMPLOYEE",type:"new"}),w.value.create_btn=!1,y.value.requestServerInteraction(),Object.keys(U).forEach(n=>{U[n]=null}),b.notify({message:"User created",color:"positive",position:"top"}),k.value=!1}catch(n){b.notify({message:n.response?n.response.data.message:n.message,color:"negative",position:"top"})}};function Y(n){Object.assign(e.value,n),e.value.role=h.getAllRoles.find(m=>m.value===n.role._id),C.value=!0}async function H(n){try{const m=n.status==="BLOCKED"?"ACTIVE":"BLOCKED";await d.put(`/users/status/${n._id}`,{status:m}),y.value.requestServerInteraction(),b.notify({message:"User status updated",color:"positive",position:"top"})}catch(m){b.notify({message:m.response?m.response.data.message:m.message,color:"negative",position:"top"})}}function G(n){b.dialog({title:"Delete User Record",message:"Are you sure you want to delete this user record?",cancel:!0,persistent:!0}).onOk(()=>{d.delete(`/users/${n}`).then(()=>{b.notify({color:"green-4",textColor:"white",position:"top",icon:"cloud_done",message:"user record deleted successfully"}),y.value.requestServerInteraction()}).catch(m=>{b.notify({color:"red-4",textColor:"white",position:"top",icon:"error",message:m.response?m.response.data.message:"An error occured"})})})}async function J(){try{w.value.update_btn=!0,Object.keys(e.value).forEach(n=>{n==="role"?s.append(n,e.value[n].value):s.append(n,e.value[n])}),await d.put(`/users/${e.value._id}`,s),w.value.update_btn=!1,C.value=!1,y.value.requestServerInteraction(),b.notify({message:"User updated",color:"positive",position:"top"})}catch(n){b.notify({message:n.response?n.response.data.message:n.message,color:"negative",position:"top"})}}function W(n){s.append("avatar",n)}return{rbacStore:h,registerUser:K,userRegister:U,rows:E,columns:we,confirm:k,model:c(null),name:c(null),designation:c(null),val:c(!0),tableRef:y,pagination:A,loading:D,onClick:()=>!1,onRequest:z,userUpdateDialog:C,updateCandidate:e,openUserUpdateDialog:Y,updateUserInfo:J,btnLoaders:w,toggleUserStatus:H,deleteUser:G,authStore:a,onImageUpload:W}}},Ve={class:"mx-4 py-6 flex justify-between"},Ce=r("div",{class:"text-2xl font-semibold"},"User Management",-1),ke={class:"flex gap-5"},Ue={class:""},xe={class:""},he={class:"q-px-md gt-sm"},Ae={class:"tw-py-1 tw-rounded-md"},Se={class:"flex items-center gap-4"},Qe=["src"],Re={key:1},Ie={class:"flex gap-2"},Ee={class:"text-xs"},De={class:"text-xs bg-gray-400 text-white rounded px-1"},qe={class:"text-xs"},Le={class:"text-xs"},Ne={class:"text-xs"},Te={class:"bg-blue-200 inline p-2 text-blue-800"},Pe={class:"column items-end"},Be={class:"q-pa-md lt-md"},Oe={class:"column items-end"},Fe=r("span",{class:"text-xl py-5 text-center"},"Invite new user",-1),je={class:"flex justify-center py-10"};function Me(d,t,h,a,b,w){const C=ee("AvatarUploader");return i(),S("main",null,[r("section",Ve,[Ce,r("div",ke,[a.authStore.canAccess("user_create")?(i(),g(V,{key:0,color:"orange",onClick:t[0]||(t[0]=e=>a.confirm=!0),class:"rounded-lg",unelevated:"",icon:"add",label:"Add User"})):_("",!0)])]),r("div",Ue,[r("section",xe,[r("div",he,[l(j,{flat:"",class:"h-[85vh]",rows:a.rows,ref:"tableRef",pagination:a.pagination,"onUpdate:pagination":t[4]||(t[4]=e=>a.pagination=e),loading:a.loading,onRequest:a.onRequest,columns:a.columns,style:{background:"rgba(244, 244, 244, 0.8)"}},{body:o(e=>[l(de,{class:"",props:e},{default:o(()=>[l(v,{key:"role",props:e,onClick:t[1]||(t[1]=s=>d.openDialog=!0),class:""},{default:o(()=>[r("div",Ae,[r("div",Se,[r("div",null,[l(ae,{"font-size":"20px",color:"green","text-color":"white"},{default:o(()=>[e.row.profile_img?(i(),S("img",{key:0,src:e.row.profile_img,alt:""},null,8,Qe)):(i(),S("span",Re,u(e.row.first_name.charAt(0)+e.row.last_name.charAt(0)),1))]),_:2},1024)]),r("div",Ie,[r("span",Ee,u(e.row.first_name)+" "+u(e.row.last_name),1),r("span",De,u(e.row.designation),1)])])])]),_:2},1032,["props"]),l(v,{key:"role",props:e,class:""},{default:o(()=>[r("div",null,[r("div",qe,u(e.row.email),1)])]),_:2},1032,["props"]),l(v,{key:"role",props:e,class:""},{default:o(()=>[r("div",null,[r("div",Le,u(e.row.phone_number),1)])]),_:2},1032,["props"]),l(v,{key:"role",props:e,class:""},{default:o(()=>[r("div",null,[r("div",Ne,u(e.row.createdAt),1)])]),_:2},1032,["props"]),l(v,{key:"role",props:e,onClick:t[2]||(t[2]=s=>d.openDialog=!0),class:""},{default:o(()=>[l(ie,{color:e.row.status==="ACTIVE"?"green":e.row.status==="INVITED"?"gray-500":"red","text-color":"white",label:e.row.status},null,8,["color","label"])]),_:2},1032,["props"]),l(v,{key:"role",props:e,onClick:t[3]||(t[3]=s=>d.openDialog=!0),class:""},{default:o(()=>{var s;return[r("div",Te,u((s=e.row.role)==null?void 0:s.role_name),1)]}),_:2},1032,["props"]),l(v,null,{default:o(()=>[r("div",Pe,[l(ce,{persistent:"",square:"",flat:"",padding:"none","text-color":"black",icon:"add",direction:"left",class:"border border-black"},{default:o(()=>[a.authStore.canAccess("user_write")?(i(),g(T,{key:0,flat:"",onClick:s=>a.openUserUpdateDialog(e.row),icon:"edit",class:"bg-transparent shadow-none text-blue-500"},{default:o(()=>[l(N,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:o(()=>[p(" Edit ")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.authStore.canAccess("user_write")?(i(),g(T,{key:1,flat:"",onClick:s=>a.deleteUser(e.row._id),icon:"delete",class:"bg-transparent shadow-none text-red-700"},{default:o(()=>[l(N,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:o(()=>[p(" Delete ")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.authStore.canAccess("user_write")?(i(),g(T,{key:2,flat:"",icon:e.row.status==="ACTIVE"?"lock_open":"lock",color:e.row.status==="ACTIVE"?"green":"red",onClick:s=>a.toggleUserStatus(e.row),class:"bg-transparent shadow-none text-gray-700"},{default:o(()=>[l(N,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:o(()=>[p(u(e.row.status==="ACTIVE"?"Unblocked":"Blocked"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick"])):_("",!0)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","pagination","loading","onRequest","columns"])]),r("div",Be,[l(j,{rows:a.rows,columns:a.columns,"row-key":"name",selection:"multiple",selected:d.selected,"onUpdate:selected":t[5]||(t[5]=e=>d.selected=e),filter:d.filter,grid:"","hide-header":""},{item:o(e=>[r("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:le(e.selected?"transform: scale(0.95);":"")},[l(q,{bordered:"",flat:"",class:te(e.selected?d.$q.dark.isActive?"bg-grey-9":"bg-grey-2":"")},{default:o(()=>[l(L,{class:"flex justify-between bg-green text-white"},{default:o(()=>[l(oe,{dense:"",modelValue:e.selected,"onUpdate:modelValue":s=>e.selected=s,label:e.row.name,color:"white","keep-color":""},null,8,["modelValue","onUpdate:modelValue","label"]),r("div",Oe,[l(V,{flat:"",icon:"more_vert"},{default:o(()=>[l(ue,{anchor:"top middle",self:"top right"},{default:o(()=>[a.authStore.canAccess("user_write")?(i(),g(R,{key:0,clickable:"",onClick:s=>a.openUserUpdateDialog(e.row)},{default:o(()=>[l(x,null,{default:o(()=>[p("Edit")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.authStore.canAccess("user_write")?(i(),g(R,{key:1,clickable:"",onClick:s=>a.deleteUser(e.row._id)},{default:o(()=>[l(x,null,{default:o(()=>[p("Delete")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.authStore.canAccess("user_write")?(i(),g(R,{key:2,clickable:"",onClick:s=>a.toggleUserStatus(e.row)},{default:o(()=>[l(x,null,{default:o(()=>[p(u(e.row.status==="ACTIVE"?"Block":"Unblock"),1)]),_:2},1024)]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1024)])]),_:2},1024),l(se),l(ge,{dense:""},{default:o(()=>[(i(!0),S(ne,null,re(e.cols.filter(s=>s.name!=="desc"),s=>(i(),g(R,{key:s.name},{default:o(()=>[l(x,null,{default:o(()=>[s.label!="Action"?(i(),g(I,{key:0,caption:""},{default:o(()=>[p(u(s.label),1)]),_:2},1024)):_("",!0)]),_:2},1024),l(x,{side:""},{default:o(()=>[s.label=="User"?(i(),g(I,{key:0},{default:o(()=>[p(u(e.row.first_name)+" "+u(e.row.last_name),1)]),_:2},1024)):s.label=="Role"?(i(),g(I,{key:1},{default:o(()=>{var k;return[p(u((k=s.value)==null?void 0:k.role_name),1)]}),_:2},1024)):(i(),g(I,{key:2},{default:o(()=>[p(u(s.value),1)]),_:2},1024))]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),_:1},8,["rows","columns","selected","filter"])])])]),l(O,{modelValue:a.confirm,"onUpdate:modelValue":t[15]||(t[15]=e=>a.confirm=e),class:"",persistent:""},{default:o(()=>[l(q,{class:"my-card p-10",style:{width:"1020px","max-width":"80vw"}},{default:o(()=>[Fe,l(L,{class:"grid md:grid-cols-2 grid-cols-1 gap-5"},{default:o(()=>[l(f,{outlined:"",modelValue:a.userRegister.first_name,"onUpdate:modelValue":t[6]||(t[6]=e=>a.userRegister.first_name=e),label:"First Name","bg-color":"white",dense:!0},null,8,["modelValue"]),l(f,{outlined:"",modelValue:a.userRegister.last_name,"onUpdate:modelValue":t[7]||(t[7]=e=>a.userRegister.last_name=e),label:"Last Name","bg-color":"white",dense:!0},null,8,["modelValue"]),l(f,{outlined:"",modelValue:a.userRegister.email,"onUpdate:modelValue":t[8]||(t[8]=e=>a.userRegister.email=e),label:"Email",dense:!0},{prepend:o(()=>[l(Q,{name:"mail"})]),_:1},8,["modelValue"]),l(f,{outlined:"",modelValue:a.userRegister.phone_number,"onUpdate:modelValue":t[9]||(t[9]=e=>a.userRegister.phone_number=e),label:"Phone Number",dense:!0},{prepend:o(()=>[l(Q,{name:"phone"})]),_:1},8,["modelValue"]),l(f,{outlined:"",modelValue:a.userRegister.designation,"onUpdate:modelValue":t[10]||(t[10]=e=>a.userRegister.designation=e),label:"Designation","bg-color":"white",dense:!0},null,8,["modelValue"]),l(M,{class:"bg-white",outlined:"",modelValue:a.userRegister.role,"onUpdate:modelValue":t[11]||(t[11]=e=>a.userRegister.role=e),options:a.rbacStore.getAllRoles,dense:!0,label:"Select role"},null,8,["modelValue","options"]),l(f,{outlined:"",modelValue:a.userRegister.salary,"onUpdate:modelValue":t[12]||(t[12]=e=>a.userRegister.salary=e),label:"Salary","bg-color":"white",dense:!0},null,8,["modelValue"])]),_:1}),l(F,{align:"center",class:"row mx-2 py-5"},{default:o(()=>[l(V,{label:"Create",color:"green",loading:a.btnLoaders.create_btn,class:"col",onClick:t[13]||(t[13]=e=>a.registerUser())},null,8,["loading"]),l(V,{label:"Cancel",color:"negative",class:"col",onClick:t[14]||(t[14]=e=>a.confirm=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(O,{modelValue:a.userUpdateDialog,"onUpdate:modelValue":t[25]||(t[25]=e=>a.userUpdateDialog=e),class:"",persistent:""},{default:o(()=>[l(q,{class:"my-card p-10",style:{width:"1020px","max-width":"80vw"}},{default:o(()=>[r("div",je,[l(C,{image:a.updateCandidate.profile_img,onImageSelected:a.onImageUpload},null,8,["image","onImageSelected"])]),l(L,{class:"grid grid-cols-2 gap-5"},{default:o(()=>[l(f,{outlined:"",modelValue:a.updateCandidate.first_name,"onUpdate:modelValue":t[16]||(t[16]=e=>a.updateCandidate.first_name=e),label:"First Name","bg-color":"white",dense:!0},null,8,["modelValue"]),l(f,{outlined:"",modelValue:a.updateCandidate.last_name,"onUpdate:modelValue":t[17]||(t[17]=e=>a.updateCandidate.last_name=e),label:"Last Name","bg-color":"white",dense:!0},null,8,["modelValue"]),l(f,{outlined:"",modelValue:a.updateCandidate.email,"onUpdate:modelValue":t[18]||(t[18]=e=>a.updateCandidate.email=e),label:"Email",dense:!0},{prepend:o(()=>[l(Q,{name:"mail"})]),_:1},8,["modelValue"]),l(f,{outlined:"",modelValue:a.updateCandidate.phone_number,"onUpdate:modelValue":t[19]||(t[19]=e=>a.updateCandidate.phone_number=e),label:"Phone Number",dense:!0},{prepend:o(()=>[l(Q,{name:"phone"})]),_:1},8,["modelValue"]),l(f,{outlined:"",modelValue:a.updateCandidate.designation,"onUpdate:modelValue":t[20]||(t[20]=e=>a.updateCandidate.designation=e),label:"Designation","bg-color":"white",dense:!0},null,8,["modelValue"]),l(f,{outlined:"",modelValue:a.updateCandidate.salary,"onUpdate:modelValue":t[21]||(t[21]=e=>a.updateCandidate.salary=e),label:"Salary","bg-color":"white",dense:!0},null,8,["modelValue"]),l(M,{class:"bg-white",outlined:"",modelValue:a.updateCandidate.role,"onUpdate:modelValue":t[22]||(t[22]=e=>a.updateCandidate.role=e),options:a.rbacStore.getAllRoles,dense:!0,label:"Select role"},null,8,["modelValue","options"])]),_:1}),l(F,{align:"center",class:"row mx-2 py-5"},{default:o(()=>[l(V,{label:"Update",loading:a.btnLoaders.update_btn,color:"green",class:"col",onClick:t[23]||(t[23]=e=>a.updateUserInfo())},null,8,["loading"]),l(V,{label:"Cancel",color:"negative",class:"col",onClick:t[24]||(t[24]=e=>a.userUpdateDialog=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var oa=X(ye,[["render",Me]]);export{oa as default};
