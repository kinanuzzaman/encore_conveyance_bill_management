import{_ as Y,r as m,at as Z,$,a4 as ee,o as i,a as S,e as r,f as l,Q as v,a5 as f,a7 as _,a6 as t,ab as F,ac as ae,ae as u,ad as b,aK as le,ay as q,aL as te,aw as N,ax as oe,B as se,aa as ne,a9 as re,a8 as p,E as Q,aH as j}from"./index.5b2acc78.js";import{Q as O,a as ie,b as w}from"./QTable.9be2365e.js";import{Q as de,a as ue,b as M}from"./QSelect.fbaf293c.js";import{u as ce,Q as me,a as T,b as L}from"./rbac.store.a503f2e1.js";import{b as x,Q as I,a as R}from"./selection.9088e168.js";import{Q as fe}from"./QList.3973144f.js";import{u as ge}from"./user.store.f9dc60f8.js";import{u as be}from"./use-quasar.b612f3c1.js";import{A as _e}from"./api-service.e4a3f494.js";import{u as pe}from"./auth.store.b2378202.js";import{A as ve}from"./AvatarUploader.b3fd4829.js";import"./use-fullscreen.6b3ff2b1.js";import"./format.2a3572e1.js";import"./axios.33769ef8.js";const we=[{name:"user",required:!0,label:"User",align:"left",field:d=>d.name,format:d=>`${d}`,sortable:!0},{name:"email",align:"left",label:"Email",field:"email",sortable:!0},{name:"phone_number",align:"left",label:"Phone",field:"phone_number",sortable:!0},{name:"createdAt",align:"left",label:"Created",field:"createdAt",sortable:!0},{name:"status",align:"left",label:"Status",field:"status",sortable:!0},{name:"role",align:"left",label:"Role",field:"role"},{name:"action",label:"Action",field:"action"}],ye={components:{AvatarUploader:ve},setup(){const d=new _e,o=ge(),h=ce(),a=pe(),g=be(),y=m({create_btn:!1,update_btn:!1,status_btn:!1}),k=m(!1),e=m({}),n=new FormData;let U=m(!1);const V=Z({first_name:null,last_name:null,email:null,phone_number:null,designation:null,salary:null,role:null}),C=m(),E=m([]),D=m(!1),A=m({page:1,rowsPerPage:10,rowsNumber:10});async function z(s){const{page:c,rowsPerPage:B}=s.pagination;D.value=!0;const P=await d.get("/users",{params:{page:c,limit:B,user_type:"CLIENT"}});E.value.splice(0,E.value.length,...P.data.data),A.value.rowsNumber=P.data.total,A.value.page=c,A.value.rowsPerPage=B,D.value=!1}$(()=>{C.value.requestServerInteraction(),h.fetchAllRoles()});const K=async()=>{try{y.value.create_btn=!0,await o.userInvite({...V,role:V.role.value,user_type:"CLIENT",type:"new"}),y.value.create_btn=!1,C.value.requestServerInteraction(),Object.keys(V).forEach(s=>{V[s]=null}),g.notify({message:"Client User created",color:"positive",position:"top"}),U.value=!1}catch(s){g.notify({message:s.response?s.response.data.message:s.message,color:"negative",position:"top"})}};function H(s){Object.assign(e.value,s),e.value.role=h.getAllRoles.find(c=>c.value===s.role._id),k.value=!0}async function G(s){try{const c=s.status==="BLOCKED"?"ACTIVE":"BLOCKED";await d.put(`/users/status/${s._id}`,{status:c}),C.value.requestServerInteraction(),g.notify({message:"Client User status updated",color:"positive",position:"top"})}catch(c){g.notify({message:c.response?c.response.data.message:c.message,color:"negative",position:"top"})}}function J(s){g.dialog({title:"Delete User Record",message:"Are you sure you want to delete this user record?",cancel:!0,persistent:!0}).onOk(()=>{d.delete(`/users/${s}`).then(()=>{g.notify({color:"green-4",textColor:"white",position:"top",icon:"cloud_done",message:"Client user record deleted successfully"}),C.value.requestServerInteraction()}).catch(c=>{g.notify({color:"red-4",textColor:"white",position:"top",icon:"error",message:c.response?c.response.data.message:"An error occured"})})})}async function W(){try{y.value.update_btn=!0,Object.keys(e.value).forEach(s=>{s==="role"?n.append(s,e.value[s].value):n.append(s,e.value[s])}),await d.put(`/users/${e.value._id}`,n),y.value.update_btn=!1,k.value=!1,C.value.requestServerInteraction(),g.notify({message:"User updated",color:"positive",position:"top"})}catch(s){g.notify({message:s.response?s.response.data.message:s.message,color:"negative",position:"top"})}}function X(s){n.append("avatar",s)}return{rbacStore:h,registerUser:K,userRegister:V,rows:E,columns:we,confirm:U,model:m(null),name:m(null),designation:m(null),val:m(!0),tableRef:C,pagination:A,loading:D,onClick:()=>!1,onRequest:z,userUpdateDialog:k,updateCandidate:e,openUserUpdateDialog:H,updateUserInfo:W,btnLoaders:y,toggleUserStatus:G,deleteUser:J,authStore:a,onImageUpload:X}}},Ce={class:"mx-4 py-6 flex justify-between"},ke=r("div",{class:"text-2xl font-semibold"},"Client Management",-1),Ue={class:"flex gap-5"},Ve={class:""},xe={class:""},he={class:"q-px-md gt-sm"},Ae={class:"tw-py-1 tw-rounded-md"},Se={class:"flex items-center gap-4"},Qe=["src"],Ie={key:1},Re={class:"flex gap-2"},Ee={class:"text-xs"},De={class:"text-xs"},qe={class:"text-xs"},Ne={class:"text-xs"},Te={class:"bg-blue-200 inline p-2 text-blue-800"},Le={class:"column items-end"},Be={class:"q-pa-md lt-md"},Pe={class:"column items-end"},Fe=r("span",{class:"text-xl py-5 text-center"},"Invite new client",-1),je={class:"flex justify-center py-10"};function Oe(d,o,h,a,g,y){const k=ee("AvatarUploader");return i(),S("main",null,[r("section",Ce,[ke,r("div",Ue,[l(v,{color:"blue",onClick:o[0]||(o[0]=e=>d.$router.push("client/pending")),class:"rounded-lg",unelevated:"",label:"Pending Client"}),a.authStore.canAccess("user_create")?(i(),f(v,{key:0,color:"orange",onClick:o[1]||(o[1]=e=>a.confirm=!0),class:"rounded-lg",unelevated:"",icon:"add",label:"Add Client"})):_("",!0)])]),r("div",Ve,[r("section",xe,[r("div",he,[l(O,{flat:"",class:"h-[85vh]",rows:a.rows,ref:"tableRef",pagination:a.pagination,"onUpdate:pagination":o[3]||(o[3]=e=>a.pagination=e),loading:a.loading,onRequest:a.onRequest,columns:a.columns,style:{background:"rgba(244, 244, 244, 0.8)"}},{body:t(e=>[l(ie,{class:"",props:e},{default:t(()=>[l(w,{key:"role",props:e,onClick:o[2]||(o[2]=n=>d.openDialog=!0),class:""},{default:t(()=>[r("div",Ae,[r("div",Se,[r("div",null,[l(ae,{"font-size":"20px",color:"green","text-color":"white"},{default:t(()=>[e.row.profile_img?(i(),S("img",{key:0,src:e.row.profile_img,alt:""},null,8,Qe)):(i(),S("span",Ie,u(e.row.first_name.charAt(0)+e.row.last_name.charAt(0)),1))]),_:2},1024)]),r("div",Re,[r("span",Ee,u(e.row.first_name)+" "+u(e.row.last_name),1)])])])]),_:2},1032,["props"]),l(w,{key:"role",props:e,class:""},{default:t(()=>[r("div",null,[r("div",De,u(e.row.email),1)])]),_:2},1032,["props"]),l(w,{key:"role",props:e,class:""},{default:t(()=>[r("div",null,[r("div",qe,u(e.row.phone_number),1)])]),_:2},1032,["props"]),l(w,{key:"role",props:e,class:""},{default:t(()=>[r("div",null,[r("div",Ne,u(e.row.createdAt),1)])]),_:2},1032,["props"]),l(w,{key:"role",props:e,class:""},{default:t(()=>[l(de,{color:e.row.status==="ACTIVE"?"green":e.row.status==="INVITED"?"gray-500":"red","text-color":"white",label:e.row.status},null,8,["color","label"])]),_:2},1032,["props"]),l(w,{key:"role",props:e,class:""},{default:t(()=>{var n;return[r("div",Te,u((n=e.row.role)==null?void 0:n.role_name),1)]}),_:2},1032,["props"]),l(w,null,{default:t(()=>[r("div",Le,[l(me,{persistent:"",square:"",flat:"",padding:"none","text-color":"black",icon:"add",direction:"left",class:"border border-black"},{default:t(()=>[a.authStore.canAccess("user_write")?(i(),f(L,{key:0,flat:"",onClick:n=>a.openUserUpdateDialog(e.row),icon:"edit",class:"bg-transparent shadow-none text-blue-500"},{default:t(()=>[l(T,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:t(()=>[b(" Edit ")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.authStore.canAccess("user_write")?(i(),f(L,{key:1,flat:"",onClick:n=>a.deleteUser(e.row._id),icon:"delete",class:"bg-transparent shadow-none text-red-700"},{default:t(()=>[l(T,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:t(()=>[b(" Delete ")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.authStore.canAccess("user_write")?(i(),f(L,{key:2,flat:"",icon:e.row.status==="ACTIVE"?"lock_open":"lock",color:e.row.status==="ACTIVE"?"green":"red",onClick:n=>a.toggleUserStatus(e.row),class:"bg-transparent shadow-none text-gray-700"},{default:t(()=>[l(T,{class:"bg-blue-6 text-xs",anchor:"top middle",self:"center middle",offset:[10,10]},{default:t(()=>[b(u(e.row.status==="ACTIVE"?"Unblocked":"Blocked"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick"])):_("",!0)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","pagination","loading","onRequest","columns"])]),r("div",Be,[l(O,{rows:a.rows,columns:a.columns,"row-key":"name",selection:"multiple",selected:d.selected,"onUpdate:selected":o[4]||(o[4]=e=>d.selected=e),filter:d.filter,grid:"","hide-header":""},{item:t(e=>[r("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:le(e.selected?"transform: scale(0.95);":"")},[l(q,{bordered:"",flat:"",class:te(e.selected?d.$q.dark.isActive?"bg-grey-9":"bg-grey-2":"")},{default:t(()=>[l(N,{class:"flex justify-between bg-green text-white"},{default:t(()=>[l(oe,{dense:"",modelValue:e.selected,"onUpdate:modelValue":n=>e.selected=n,label:e.row.name,color:"white","keep-color":""},null,8,["modelValue","onUpdate:modelValue","label"]),r("div",Pe,[l(v,{flat:"",icon:"more_vert"},{default:t(()=>[l(ue,{anchor:"top middle",self:"top right"},{default:t(()=>[a.authStore.canAccess("user_write")?(i(),f(I,{key:0,clickable:"",onClick:n=>a.openUserUpdateDialog(e.row)},{default:t(()=>[l(x,null,{default:t(()=>[b("Edit")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.authStore.canAccess("user_write")?(i(),f(I,{key:1,clickable:"",onClick:n=>a.deleteUser(e.row._id)},{default:t(()=>[l(x,null,{default:t(()=>[b("Delete")]),_:1})]),_:2},1032,["onClick"])):_("",!0),a.authStore.canAccess("user_write")?(i(),f(I,{key:2,clickable:"",onClick:n=>a.toggleUserStatus(e.row)},{default:t(()=>[l(x,null,{default:t(()=>[b(u(e.row.status==="ACTIVE"?"Block":"Unblock"),1)]),_:2},1024)]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024)]),_:2},1024)])]),_:2},1024),l(se),l(fe,{dense:""},{default:t(()=>[(i(!0),S(ne,null,re(e.cols.filter(n=>n.name!=="desc"),n=>(i(),f(I,{key:n.name},{default:t(()=>[l(x,null,{default:t(()=>[n.label!="Action"?(i(),f(R,{key:0,caption:""},{default:t(()=>[b(u(n.label),1)]),_:2},1024)):_("",!0)]),_:2},1024),l(x,{side:""},{default:t(()=>[n.label=="User"?(i(),f(R,{key:0},{default:t(()=>[b(u(e.row.first_name)+" "+u(e.row.last_name),1)]),_:2},1024)):n.label=="Role"?(i(),f(R,{key:1},{default:t(()=>{var U;return[b(u((U=n.value)==null?void 0:U.role_name),1)]}),_:2},1024)):(i(),f(R,{key:2},{default:t(()=>[b(u(n.value),1)]),_:2},1024))]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),_:1},8,["rows","columns","selected","filter"])])])]),l(F,{modelValue:a.confirm,"onUpdate:modelValue":o[12]||(o[12]=e=>a.confirm=e),class:"",persistent:""},{default:t(()=>[l(q,{class:"my-card p-10",style:{width:"1020px","max-width":"80vw"}},{default:t(()=>[Fe,l(N,{class:"grid md:grid-cols-2 grid-cols-1 gap-5"},{default:t(()=>[l(p,{outlined:"",modelValue:a.userRegister.first_name,"onUpdate:modelValue":o[5]||(o[5]=e=>a.userRegister.first_name=e),label:"First Name","bg-color":"white",dense:!0},null,8,["modelValue"]),l(p,{outlined:"",modelValue:a.userRegister.last_name,"onUpdate:modelValue":o[6]||(o[6]=e=>a.userRegister.last_name=e),label:"Last Name","bg-color":"white",dense:!0},null,8,["modelValue"]),l(p,{outlined:"",modelValue:a.userRegister.email,"onUpdate:modelValue":o[7]||(o[7]=e=>a.userRegister.email=e),label:"Email",dense:!0},{prepend:t(()=>[l(Q,{name:"mail"})]),_:1},8,["modelValue"]),l(p,{outlined:"",modelValue:a.userRegister.phone_number,"onUpdate:modelValue":o[8]||(o[8]=e=>a.userRegister.phone_number=e),label:"Phone Number",dense:!0},{prepend:t(()=>[l(Q,{name:"phone"})]),_:1},8,["modelValue"]),l(M,{class:"bg-white",outlined:"",modelValue:a.userRegister.role,"onUpdate:modelValue":o[9]||(o[9]=e=>a.userRegister.role=e),options:a.rbacStore.getAllRoles,dense:!0,label:"Select role"},null,8,["modelValue","options"])]),_:1}),l(j,{align:"center",class:"row mx-2 py-5"},{default:t(()=>[l(v,{label:"Create",color:"green",loading:a.btnLoaders.create_btn,class:"col",onClick:o[10]||(o[10]=e=>a.registerUser())},null,8,["loading"]),l(v,{label:"Cancel",color:"negative",class:"col",onClick:o[11]||(o[11]=e=>a.confirm=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(F,{modelValue:a.userUpdateDialog,"onUpdate:modelValue":o[20]||(o[20]=e=>a.userUpdateDialog=e),class:"",persistent:""},{default:t(()=>[l(q,{class:"my-card p-10",style:{width:"1020px","max-width":"80vw"}},{default:t(()=>[r("div",je,[l(k,{image:a.updateCandidate.profile_img,onImageSelected:a.onImageUpload},null,8,["image","onImageSelected"])]),l(N,{class:"grid grid-cols-2 gap-5"},{default:t(()=>[l(p,{outlined:"",modelValue:a.updateCandidate.first_name,"onUpdate:modelValue":o[13]||(o[13]=e=>a.updateCandidate.first_name=e),label:"First Name","bg-color":"white",dense:!0},null,8,["modelValue"]),l(p,{outlined:"",modelValue:a.updateCandidate.last_name,"onUpdate:modelValue":o[14]||(o[14]=e=>a.updateCandidate.last_name=e),label:"Last Name","bg-color":"white",dense:!0},null,8,["modelValue"]),l(p,{outlined:"",modelValue:a.updateCandidate.email,"onUpdate:modelValue":o[15]||(o[15]=e=>a.updateCandidate.email=e),label:"Email",dense:!0},{prepend:t(()=>[l(Q,{name:"mail"})]),_:1},8,["modelValue"]),l(p,{outlined:"",modelValue:a.updateCandidate.phone_number,"onUpdate:modelValue":o[16]||(o[16]=e=>a.updateCandidate.phone_number=e),label:"Phone Number",dense:!0},{prepend:t(()=>[l(Q,{name:"phone"})]),_:1},8,["modelValue"]),l(M,{class:"bg-white",outlined:"",modelValue:a.updateCandidate.role,"onUpdate:modelValue":o[17]||(o[17]=e=>a.updateCandidate.role=e),options:a.rbacStore.getAllRoles,dense:!0,label:"Select role"},null,8,["modelValue","options"])]),_:1}),l(j,{align:"center",class:"row mx-2 py-5"},{default:t(()=>[l(v,{label:"Update",loading:a.btnLoaders.update_btn,color:"green",class:"col",onClick:o[18]||(o[18]=e=>a.updateUserInfo())},null,8,["loading"]),l(v,{label:"Cancel",color:"negative",class:"col",onClick:o[19]||(o[19]=e=>a.userUpdateDialog=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var ta=Y(ye,[["render",Oe]]);export{ta as default};
